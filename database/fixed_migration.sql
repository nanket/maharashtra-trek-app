-- Fixed Data Migration SQL for Supabase
-- This migration handles the schema mismatch between the data and database structure
-- Run this in your Supabase SQL Editor

-- Clear existing data (optional - uncomment if needed)
-- DELETE FROM treks;

-- First, let's check if we need to add the safety column or use separate columns
-- This migration assumes you're using the schema.sql structure with separate safety columns

-- Insert all trek data with proper safety column mapping
INSERT INTO treks (
    id, name, category, location, difficulty, duration, elevation, description,
    starting_point_name, starting_point_latitude, starting_point_longitude,
    starting_point_facilities, starting_point_description,
    latitude, longitude, featured, rating, review_count,
    images, videos, image_key, best_time_to_visit,
    network_availability, food_and_water, accommodation, permits,
    safety_risk_level, safety_common_risks, safety_precautions, safety_rescue_points, 
    safety_nearest_hospital, safety_emergency_numbers,
    weather, trek_route, how_to_reach, local_contacts
) VALUES
(33, 'Alang Fort (Alang–Madangad–Kulang / AMK)', 'fort', 'Nashik District, Maharashtra', 'Difficult', '9–12 hours (one way, Alang only); 2–3 days for full AMK circuit', '1372 meters', 'Alang Fort is part of the remote AMK trio (Alang, Madangad, Kulang), revered by seasoned trekkers for its challenging trails, iron ladders, rock climbs, thrilling exposed ledges, and large caves for camping. The summit delivers sweeping Sahyadri vistas and adventures of real wilderness trekking. Only for experienced trekkers with technical gear and strong navigation skills.', 'Ambewadi (primary), Ghatghar (alternative)', 19.5691, 73.6411, ARRAY['Limited parking in village', 'Basic tea/snacks (seasonal)', 'No public toilets nearby'], 'Ambewadi village is the most common base for Alang, reachable via Igatpuri–Ghoti or Kasara routes. Ghatghar is used by some for alternate circuits and is slightly more developed.', 19.5691, 73.6411, true, 4.8, 59, ARRAY['https://res.cloudinary.com/dworlkdn8/image/upload/v1754044791/treks/alang/alang_1.jpg', 'https://res.cloudinary.com/dworlkdn8/image/upload/v1754044791/treks/alang/alang_4.jpg', 'https://res.cloudinary.com/dworlkdn8/image/upload/v1754044791/treks/alang/alang_5.jpg', 'https://res.cloudinary.com/dworlkdn8/image/upload/v1754044791/treks/alang/alang_6.jpg', 'https://res.cloudinary.com/dworlkdn8/image/upload/v1754044791/treks/alang/alang_7.jpg', 'https://res.cloudinary.com/dworlkdn8/image/upload/v1754044791/treks/alang/alang_8.jpg', 'https://res.cloudinary.com/dworlkdn8/image/upload/v1754044791/treks/alang/alang_10.jpg'], NULL, 'alang', 'October to March (post-monsoon, water available, safe conditions)', '{"baseVillage":{"airtel":"Fair","jio":"Fair","vodafone":"Weak","bsnl":"Fair"},"duringTrek":{"airtel":"Intermittent","jio":"Intermittent","vodafone":"No signal","bsnl":"No signal"},"atSummit":{"airtel":"No signal","jio":"No signal","vodafone":"No signal","bsnl":"No signal"},"emergencyContact":"Pre-trek notification highly recommended. Dial 108/112 if/when network is available. No medical/rescue post en route."}'::jsonb, '{"atBase":{"restaurants":["Home-cooked meals (pre-arrange at homestays)","Basic snacks at tea stalls (seasonal)"],"shops":["Small grocery shop (Ambewadi)","Water bottles (availability not guaranteed)"],"waterSources":["Village wells (treatment recommended)"]},"duringTrek":{"waterSources":["Large cisterns/caves (quality varies, especially late season)","Carry minimum 3L per person"],"foodOptions":["No food stalls after base. Carry packed meals.","Arrange basic meals in Ambewadi (dal–rice/poha on request)"],"recommendations":["High-energy food","Dry fruits","Chocolate/energy bars"]},"atSummit":{"facilities":["Caves for camping","Cisterns for water (treatment required)"],"recommendations":["Boil/filter cistern water before use","No food available—carry all supplies"]}}'::jsonb, '{"camping":{"allowed":true,"locations":["Alang Fort caves","Plateau near summit"],"facilities":["Natural caves (basic shelter)","Flat ground for tents"],"cost":"Free (must be fully self-sufficient)"},"nearbyStays":[{"name":"Lakhan Goikane Homestay","distance":"in Ambewadi village","cost":"₹500-800 per person (approx.)","contact":"9975402070","facilities":["Basic rooms","Home-cooked meals","Pre-trek arrangements"]},{"name":"Reeva''s Homestay","distance":"in Ghatghar village","cost":"₹400-800 per person (approx.)","contact":"9764924535","facilities":["Basic rooms","Meals (on advance booking)"]}]}'::jsonb, '{"required":false,"forestDepartment":"Not required","entry":"Free entry","timings":"Entry before noon advised; overnight camping permitted with village knowledge"}'::jsonb, 'High', ARRAY['Slippery, exposed ledges (monsoon risk)', 'Technical/vertical sections requiring ropes/ladder', 'Navigation errors due to fog/rocky terrain', 'Limited water in summer'], ARRAY['Experienced team with technical gear', 'First aid kit', 'Notify local contacts before starting', 'GPS/GPX route tracking'], ARRAY['Ambewadi village', 'Ghatghar village', 'Base of Kulang Fort (AMK circuit)'], '{"name":"Ghoti Rural Hospital","distance":"40 km (approx.)","contact":"02553-221379"}'::jsonb, '{"ambulance":"108","police":"112"}'::jsonb, '{"monsoon":{"months":"June-September","conditions":"Heavy rain, slippery rock, high exposure, frequent fog, leeches","recommendation":"Attempt ONLY by highly experienced, fully prepared teams during dry days"},"winter":{"months":"December-February","conditions":"Cool, mostly dry, best visibility, good water (post-monsoon)","recommendation":"Best time for trek"},"summer":{"months":"March-May","conditions":"Hot, harsh sun, scarce water, rocky sections exposed","recommendation":"Avoid unless fully prepared. Carry extra water."}}'::jsonb, '{"totalDistance":"12 km (approx. round trip to Alang only)","ascent":"950 meters","difficulty":"High – technical sections, exposed traverses","waypoints":[{"name":"Ambewadi Village","elevation":"700m","description":"Main base; basic facilities"},{"name":"Ridge/Base","elevation":"900m","description":"Start steep rocky ascent"},{"name":"Exposed Ledge Section","elevation":"1100m","description":"Rope/ladder often necessary"},{"name":"Iron Ladder Entry","elevation":"1250m","description":"Technical access to fort"},{"name":"Summit/Caves","elevation":"1372m","description":"Caves for camping; sweeping views"}]}'::jsonb, '{"fromMumbai":{"byTrain":{"description":"Train to Kasara/Igatpuri, then private vehicle to Ambewadi","distance":"140 km (to base)","time":"4-5 hours (to base)","steps":["Take local train Mumbai CST to Kasara or outstation train to Igatpuri","Hire shared/private jeep from Kasara/Igatpuri to Ambewadi (via Ghoti)","Trek starts from Ambewadi village"]},"byBus":{"description":"ST bus via Ghoti or Igatpuri to Ambewadi (irregular services)","distance":"145 km","time":"5-6 hours","steps":["ST bus to Ghoti or Igatpuri from Mumbai/Pune","Change for local bus or jeep to Ambewadi","Start trek from Ambewadi"]},"byPrivateVehicle":{"description":"Drive via Mumbai–Nashik highway, exit at Ghoti to Ambewadi","distance":"140 km","time":"3.5–4.5 hours","steps":["Take NH160 Mumbai–Nashik highway","At Ghoti, take Ghoti–Bhandardara road to Ambewadi","Limited parking in Ambewadi"]}},"fromPune":{"byTrain":{"description":"Train Pune to Igatpuri, then jeep/taxi onward","distance":"210 km","time":"6–7 hours","steps":["Long-distance train to Igatpuri","Jeep/taxi to Ambewadi (via Ghoti/Bhandardara)","Trek starts from Ambewadi"]},"byBus":{"description":"ST bus via Ghoti/Igatpuri; connection to Ambewadi","distance":"220 km","time":"6–8 hours with connections","steps":["ST bus to Nashik or Ghoti","Change to Ghoti–Ambewadi local bus/jeep (if available)","Start trek from Ambewadi"]},"byPrivateVehicle":{"description":"Drive via Pune–Nashik–Ghoti–Ambewadi","distance":"210 km","time":"5.5–6.5 hours","steps":["Pune–Nashik highway to Ghoti","Ghoti–Bhandardara road to Ambewadi","Limited parking at Ambewadi"]}}}'::jsonb, '[{"name":"Lakhan Goikane","phone":"9975402070","service":"Local Guide, Food & Homestay"},{"name":"Kailash Kekare","phone":"7972880016","service":"Technical Guiding, Rope/Ladder Setup"},{"name":"Sunil Gawali","phone":"8007422062","service":"Navigation, Camping, Transport"}]'::jsonb),

(2, 'Lohagad Fort', 'fort', 'Pune District, Maharashtra', 'Easy', '2-3 hours (one way; base to summit)', '1,033 meters', 'Lohagad is a UNESCO World Heritage site and one of Maharashtra''s most accessible forts. Known for its massive gates, fortified ramparts, and the distinctive ''Vinchu Kata'' (scorpion''s tail) extension, Lohagad was historically an important outpost for Chhatrapati Shivaji Maharaj. The route is well-marked and suited for beginners and families. Views of Pawna Lake, Bhaje Caves, and lush valleys are a highlight—especially during the monsoon.', 'Lohagadwadi Village', 18.7104, 73.4763, ARRAY['Ample parking', 'Eateries', 'Basic shops', 'Local guides', 'Public toilets (at village and fort base)'], 'Lohagadwadi is the main base village, directly connected by road from Malavli/Lonavala. Offers essential amenities, food, and paid parking. Trek starts right from the village edge.', 18.7104, 73.4763, true, 4.7, 321, ARRAY['https://res-console.cloudinary.com/dworlkdn8/thumbnails/v1/image/upload/v1751814903/dHJla2FwcC9mb3J0L2xvaGFnYWQvMTA3MTI5OTAtNjk4OTU0NjIwMTg4ODU1LTI2ODQ5MDc0NDU5MTkxODI3NjItbnByYWthc2gtcGl0a2FyLWZhY2Vib29rLWNyb3BwZWQtMTU2MDQxNjA2Ml9ld3EwMzI=/list_v2'], ARRAY['https://res.cloudinary.com/dworlkdn8/video/upload/v1754044854/treks/lohagad/lohagad_scenic.mp4'], 'lohagad', 'June to February (monsoon and post-monsoon/winter months)', '{"baseVillage":{"airtel":"Good","jio":"Good","vodafone":"Good","bsnl":"Good"},"duringTrek":{"airtel":"Fair","jio":"Fair","vodafone":"Fair","bsnl":"Fair"},"atSummit":{"airtel":"Good","jio":"Good","vodafone":"Fair","bsnl":"Fair"},"emergencyContact":"108 (ambulance); 112 (emergency). All networks generally work at base and summit."}'::jsonb, '{"atBase":{"restaurants":["Shree Ganesh Dhaba","Lohagadwadi Snacks Centre","Tea & Bhajiya Shops"],"shops":["General stores","Water bottles","Basic snacks"],"waterSources":["Village wells","Packaged water available"]},"duringTrek":{"waterSources":["Seasonal springs en route (monsoon/post-monsoon)","Carry 2L minimum per person"],"foodOptions":["Packaged food/snacks available at stalls en route (seasonal)","Recommended to carry your own meal in off-season"],"recommendations":["Light snacks","Energy bars","Hydration pack"]},"atSummit":{"facilities":["Seasonal snacks and tea stalls (monsoon and weekends)","Ancient cistern (water not always potable)"],"recommendations":["Carry water in dry season","Enjoy local lemon sherbet during monsoon"]}}'::jsonb, '{"camping":{"allowed":true,"locations":["Fort summit area","Near Ganesh Darwaja"],"facilities":["Open terraces","Basic shelter in fort rooms (no locks, bring sleeping bag/tent)"],"cost":"Free (own tent/sleeping gear required)"},"nearbyStays":[{"name":"Lohagadwadi Homestay","distance":"At base village","cost":"₹600-900 per person","contact":"+91 8390944643","facilities":["Simple rooms","Home-cooked meals","Parking"]},{"name":"MTDC Resort","distance":"8 km (Lonavala)","cost":"₹2,000-4,500 per room","contact":"+91 2114-273055","facilities":["AC/Non-AC rooms","Restaurant"]}]}'::jsonb, '{"required":false,"forestDepartment":"Not required","entry":"Free entry","timings":"Open sunrise to sunset; camping allowed"}'::jsonb, 'Low', ARRAY['Slippery steps during monsoon', 'Crowds on weekends/holidays', 'Loose stones on some sections'], ARRAY['Wear grippy shoes in wet season', 'Avoid railings during heavy wind/rains', 'Hydrate and pace yourself'], ARRAY['Lohagadwadi base', 'Ganesh Darwaja (main gate)', 'Fort summit'], '{"name":"Rural Hospital Lonavala","distance":"12 km","contact":"+91 2114-273055"}'::jsonb, '{"ambulance":"108","police":"112"}'::jsonb, '{"monsoon":{"months":"June-September","conditions":"Heavy rain, lush green, clouds/mist, very slippery steps","recommendation":"Very popular—carry rainwear and prepare for crowds"},"winter":{"months":"December-February","conditions":"Cool, clear skies, ideal for families","recommendation":"Best trekking weather"},"summer":{"months":"March-May","conditions":"Warm mid-day, lesser crowds, dry path","recommendation":"Start early morning; carry extra water"}}'::jsonb, '{"totalDistance":"5 km (round trip from base to summit)","ascent":" Approximately 350 meters","difficulty":"Easy (well-paved steps, some steeper sections)","waypoints":[{"name":"Lohagadwadi Village","elevation":"800m","description":"Base with parking, shops, food"},{"name":"Ganesh Darwaja","elevation":"950m","description":"First major entry, iconic stone arch"},{"name":"Narayan Darwaja","elevation":"990m","description":"Second major gate on route"},{"name":"Main Fort Entrance","elevation":"1025m","description":"Large flights of stone steps"},{"name":"Lohagad Summit","elevation":"1,033m","description":"Flag point, huge ramparts, Vinchu Kata"}]}'::jsonb, '{"fromMumbai":{"byTrain":{"description":"Train to Lonavala or Malavli, then local transport","distance":"100 km","time":"3 hours","steps":["Train from Mumbai CST to Lonavala (intercity express/local)","Change for local train to Malavli (2 stops)","Share auto or trek (2 km, 30 minutes) to Lohagadwadi"]},"byBus":{"description":"ST or private bus to Lonavala, then taxi/auto","distance":"110 km","time":"3.5-4 hours","steps":["Bus to Lonavala from Mumbai/Pune","Local rickshaw to Malavli village/fort base","Trek from there to fort"]},"byPrivateVehicle":{"description":"Drive via Mumbai–Pune Expressway to Malavli","distance":"100 km","time":"2.5-3 hours","steps":["Take Mumbai–Pune Expressway","Exit at Lonavala, follow signs to Malavli and Lohagadwadi"]}},"fromPune":{"byTrain":{"description":"Train from Pune to Malavli, then walk/auto","distance":"65 km","time":"1.5 hours","steps":["Board Pune–Lonavala local train, get down at Malavli","Share auto or trek to Lohagadwadi"]},"byBus":{"description":"Bus to Lonavala, then local auto","distance":"65 km","time":"2–2.5 hours","steps":["Pune to Lonavala by ST/private bus","Auto to Malavli/Lohagadwadi"]},"byPrivateVehicle":{"description":"Drive via Mumbai–Pune Expressway or old highway","distance":"70 km","time":"1.5–2 hours","steps":["Take Expressway/Old Pune-Mumbai highway to Lonavala","Via Malavli to Lohagadwadi"]}}}'::jsonb, '[{"name":"Ganpat Lohagadkar","phone":"+91 9766529833","service":"Local Guide, Homestay"},{"name":"Lohagadwadi Grampanchayat","phone":"+91 2114-222311","service":"Village Info, Assistance, Emergency"}]'::jsonb);

-- Handle conflicts by updating existing records
ON CONFLICT (id) DO UPDATE SET
    name = EXCLUDED.name,
    category = EXCLUDED.category,
    location = EXCLUDED.location,
    difficulty = EXCLUDED.difficulty,
    duration = EXCLUDED.duration,
    elevation = EXCLUDED.elevation,
    description = EXCLUDED.description,
    starting_point_name = EXCLUDED.starting_point_name,
    starting_point_latitude = EXCLUDED.starting_point_latitude,
    starting_point_longitude = EXCLUDED.starting_point_longitude,
    starting_point_facilities = EXCLUDED.starting_point_facilities,
    starting_point_description = EXCLUDED.starting_point_description,
    latitude = EXCLUDED.latitude,
    longitude = EXCLUDED.longitude,
    featured = EXCLUDED.featured,
    rating = EXCLUDED.rating,
    review_count = EXCLUDED.review_count,
    images = EXCLUDED.images,
    videos = EXCLUDED.videos,
    image_key = EXCLUDED.image_key,
    best_time_to_visit = EXCLUDED.best_time_to_visit,
    network_availability = EXCLUDED.network_availability,
    food_and_water = EXCLUDED.food_and_water,
    accommodation = EXCLUDED.accommodation,
    permits = EXCLUDED.permits,
    safety_risk_level = EXCLUDED.safety_risk_level,
    safety_common_risks = EXCLUDED.safety_common_risks,
    safety_precautions = EXCLUDED.safety_precautions,
    safety_rescue_points = EXCLUDED.safety_rescue_points,
    safety_nearest_hospital = EXCLUDED.safety_nearest_hospital,
    safety_emergency_numbers = EXCLUDED.safety_emergency_numbers,
    weather = EXCLUDED.weather,
    trek_route = EXCLUDED.trek_route,
    how_to_reach = EXCLUDED.how_to_reach,
    local_contacts = EXCLUDED.local_contacts,
    updated_at = NOW();

-- Verify the data was inserted
SELECT 
    category,
    COUNT(*) as count,
    COUNT(CASE WHEN featured = true THEN 1 END) as featured_count
FROM treks 
GROUP BY category
ORDER BY category;

-- Show total count
SELECT COUNT(*) as total_treks FROM treks;

-- Show sample data
SELECT id, name, category, location, difficulty, featured, rating 
FROM treks 
ORDER BY category, name 
LIMIT 10;
